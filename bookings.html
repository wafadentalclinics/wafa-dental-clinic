<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WDC - Bookings</title> <!-- Title from bookings.html -->
    <!-- Theme Color for Browser UI (e.g., Safari, Chrome mobile) -->
    <meta name="theme-color" content="#010245">
    <!-- Favicon and Open Graph tags -->
    <link rel="icon" type="image/png" href="images/favicon.png">
    <meta property="og:title" content="WAFA Dental Clinic">
    <meta property="og:description" content="Never Too Late To Improve Your Smile!">
    <link rel="icon" type="image/x-icon" href="images/favicon.ico" />
    <meta property="og:image" content="images/og-picture.png">
    <meta property="og:url" content="https://www.wafadentalclinic.com">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" xintegrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXUxC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Google reCAPTCHA v2 script -->
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <style>
        /* Custom Tailwind configuration */
        :root {
            --primary-blue: #010245;
            /* Premium gradient colors */
            --gradient-start: #04052e;
            --gradient-middle: #061a70;
            --gradient-end: #c6d9f5;
        }
        
        /* Custom fonts and utility classes */
        body {
            font-family: 'Inter', sans-serif;
            color: #2D3748;
            scroll-behavior: smooth;
            background-color: #F7F7F7; /* Reverted to original light gray */
        }

        .font-dm-serif {
            font-family: 'DM Serif Display', serif;
        }

        /* Fade-in animation for sections and elements with a smoother feel */
        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 1.2s cubic-bezier(0.25, 1, 0.5, 1), transform 1.2s cubic-bezier(0.25, 1, 0.5, 1);
        }

        .fade-in.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Adds a subtle delay for children elements */
        .fade-in.is-visible > * {
            transition: opacity 0.8s cubic-bezier(0.25, 1, 0.5, 1), transform 0.8s cubic-bezier(0.25, 1, 0.5, 1);
            transition-delay: var(--delay);
        }

        .card-with-glass {
            background-color: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
        }

        /* Styles for the premium glass buttons */
        .button-glass-white {
            background-color: rgba(255, 255, 255, 0.5); /* Semi-transparent white */
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .button-glass-white:hover {
            background-color: rgba(255, 255, 255, 0.8);
            border-color: rgba(255, 255, 255, 0.7);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1), 0 6px 6px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        /* Apple-like hover effect for the 'Book Now' button */
        .book-now-button:hover {
            transform: translateY(-4px); /* Reverted translateY to match Our Story button */
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2), 0 6px 12px rgba(0, 0, 0, 0.15); /* Reverted box-shadow to match Our Story button */
        }

        /* Apple-like form field styling */
.apple-input {
            border: 1px solid #d1d5db; /* A softer gray border */
            border-radius: 0.75rem; /* More rounded corners */
            padding: 0.5rem 1rem; /* Reduced padding for compactness */
            height: 2.75rem; /* Consistent height with dropdowns */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); /* Subtle shadow */
            transition: all 0.2s ease-in-out;
        }

        .apple-input:focus {
            outline: none;
            border-color: #6366f1; /* A light indigo/blue border on focus */
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); /* Soft focus ring */
        }

        /* Explicit transition for the back button for a smoother "apple-like" pop-up */
        #backToPatientTypeBtn {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        
        /* Mobile menu animation */
        #mobile-menu {
            transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            max-height: 0;
            overflow: hidden;
            opacity: 0;
        }
        #mobile-menu.is-open {
            max-height: 500px; /* A value large enough to contain all content */
            opacity: 1;
        }
        /* Mobile menu icon animation (Apple-like) */
        #mobile-menu-button {
            width: 20px; /* Maintain current width */
            height: 14px; /* Adjusted height for a more minimal look and better spacing */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            cursor: pointer;
            padding: 0;
            position: relative;
            z-index: 20;
            transition: none; /* Ensure no hover effect on the button itself */
        }
        #mobile-menu-button span {
            display: block;
            width: 100%;
            height: 1.2px; /* Thinner bars for a more refined look */
            background-color: white;
            border-radius: 0px; /* Keep corners sharp for a modern, unified look */
            transition: transform 0.3s cubic-bezier(0.25, 0.1, 0.25, 1), opacity 0.3s cubic-bezier(0.25, 0.1, 0.25, 1); /* Explicitly define transitions for transform and opacity */
        }
        #mobile-menu-button.is-open span:nth-child(1) {
            transform: translateY(6.4px) rotate(45deg); /* Recalculated translateY for 1.2px thickness and 14px height */
        }
        #mobile-menu-button.is-open span:nth-child(2) {
            opacity: 0;
            transform: translateX(-10px); /* Slide out the middle bar */
        }
        #mobile-menu-button.is-open span:nth-child(3) {
            transform: translateY(-6.4px) rotate(-45deg); /* Recalculated translateY for 1.2px thickness and 14px height */
        }

        /* Explicitly hide mobile menu button on medium and larger screens */
        @media (min-width: 768px) {
            #mobile-menu-button {
                display: none !important;
            }
        }

        /* Gradient animation for hero section */
        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .animate-gradient-shift {
            background-size: 400% 400%;
            animation: gradient-shift 15s ease infinite;
        }
    </style>
    <style>
.whatsapp-float {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 58px;
  height: 58px;
  background: var(--primary-blue); /* Changed to navy blue */
  border-radius: 50%;
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  cursor: pointer;
  transition: all 0.3s ease;
}

.whatsapp-float img {
  width: 28px;
  height: 28px;
}

/* Hover animation */
.whatsapp-float:hover {
  transform: scale(1.12) translateY(-3px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.3);
}

/* Tooltip styling */
.tooltip {
  position: absolute;
  right: 70px;
  background: #333;
  color: #fff;
  padding: 6px 10px;
  border-radius: 6px;
  font-size: 13px;
  opacity: 0;
  white-space: nowrap;
  pointer-events: none;
  transition: opacity 0.3s ease;
}

/* Tooltip arrow */
.tooltip::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 100%;
  margin-top: -6px;
  border-width: 6px;
  border-style: solid;
  border-color: transparent transparent transparent #333;
}

/* Show tooltip on hover */
.whatsapp-float:hover .tooltip {
  opacity: 1;
}
    </style>
    <style>
/* Styles for custom dropdowns */
.custom-dropdown-container {
    position: relative;
    width: 100%; /* Ensure full width on mobile by default */
}

/* Mobile-specific adjustments for time dropdowns */
@media (max-width: 767px) {
    .time-dropdown-field {
        width: calc(50% - 0.25rem); /* 50% width minus half the gap (gap-2 is 0.5rem, so half is 0.25rem) */
        box-sizing: border-box; /* Ensure padding and border are included in the width */
    }
}

.custom-dropdown-input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    width: 100%;
    cursor: pointer;
    border: 1px solid #d1d5db; /* A softer gray border */
    border-radius: 0.75rem; /* More rounded corners */
    padding: 0.5rem 1rem; /* Reduced padding for compactness */
    height: 2.75rem; /* Consistent height with dropdowns */
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); /* Subtle shadow */
    transition: all 0.2s ease-in-out;
}

.custom-dropdown-input-wrapper:focus-within {
    outline: none;
    border-color: #6366f1; /* A light indigo/blue border on focus */
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); /* Soft focus ring */
}

.custom-dropdown-text-input {
    flex-grow: 1;
    border: none;
    outline: none;
    background: transparent;
    cursor: pointer;
    padding-right: 1.5rem; /* Space for the icon */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    height: 100%; /* Ensure input fills the wrapper height */
}

.custom-dropdown-icon {
    position: absolute;
    right: 1rem; /* Aligned to the far right inside the input, consistent with other inputs */
    top: 50%;
    transform: translateY(-50%);
    pointer-events: none;
    transition: transform 0.2s ease-in-out;
    width: 1rem; /* Standard icon size (w-4 h-4 is 1rem) */
    height: 1rem; /* Standard icon size (w-4 h-4 is 1rem) */
}

.custom-dropdown-input-wrapper[aria-expanded="true"] .custom-dropdown-icon {
    transform: translateY(-50%) rotate(180deg);
}

/* Adjustments for mobile time dropdown fields */
@media (max-width: 767px) {
    .time-dropdown-field .custom-dropdown-input-wrapper {
        padding: 0.4rem 0.8rem; /* Slightly smaller padding for mobile */
        height: 2.5rem; /* Slightly smaller height for mobile */
    }
    .time-dropdown-field .custom-dropdown-text-input {
        font-size: 0.8rem; /* Smaller font size for mobile */
    }
    .time-dropdown-field .custom-dropdown-icon {
        right: 0.8rem; /* Adjust icon position for smaller fields */
        width: 0.9rem;
        height: 0.9rem;
    }
}

.custom-dropdown-menu {
    position: absolute;
    top: calc(100% + 8px); /* Slightly more space below the input */
    left: 0;
    right: 0;
    background-color: #fff;
    border: 1px solid #d1d5db;
    border-radius: 0.75rem;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15); /* More pronounced shadow for premium feel */
    max-height: 200px; /* Reduced max-height for more options */
    overflow-y: auto;
    z-index: 100;
    opacity: 0;
    visibility: hidden;
    transform: translateY(10px);
    transition: opacity 0.3s ease-out, transform 0.3s ease-out, visibility 0.3s ease-out; /* Smoother transition */
    box-sizing: border-box; /* Ensure padding is included in width */
}

.custom-dropdown-menu.is-open {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.custom-dropdown-menu li {
    padding: 0.5rem 1rem; /* Matched padding with apple-input for consistency */
    cursor: pointer;
    transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
    font-size: 0.875rem; /* Matched with text-sm for consistency */
    color: #333;
}

.custom-dropdown-menu li:hover {
    background-color: #e0e7ff; /* Light blue hover, consistent with calendar */
    color: var(--primary-blue);
}

/* Style for selected dropdown item */
.custom-dropdown-menu li.selected {
    background-color: #dbeafe; /* Even lighter blue when selected */
    color: var(--primary-blue);
    font-weight: 600;
}



/* Styles for the custom calendar */
.calendar-container {
    position: relative;
    width: 100%;
}

.calendar-input {
    cursor: pointer;
    padding-right: 2.5rem; /* Space for the icon */
    height: 2.75rem; /* Consistent height with other form inputs */
    display: flex;
    align-items: center;
}

.calendar-icon {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    pointer-events: none;
    transition: transform 0.2s ease-in-out;
}

.calendar-input[aria-expanded="true"] + .calendar-icon {
    transform: translateY(-50%) rotate(180deg);
}

.calendar-popup {
    position: absolute;
    top: calc(100% + 8px); /* Slightly more space below the input */
    left: 0; /* Align to the left of the input */
    width: 100%; /* Take full width of its parent container */
    max-width: 300px; /* Reduced max width for larger screens */
    background-color: #fff;
    border: 1px solid #d1d5db;
    border-radius: 0.75rem;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15); /* More pronounced shadow */
    z-index: 100;
    padding: 1rem;
    opacity: 0;
    visibility: hidden;
    transform: translateY(10px);
    transition: opacity 0.3s ease-out, transform 0.3s ease-out, visibility 0.3s ease-out; /* Smoother transition */
    box-sizing: border-box; /* Ensure padding is included in width */
}

.calendar-popup.is-open {
    opacity: 1;
    visibility: visible;
    transform: translateY(0); /* Adjust transform for opening */
}

.calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.calendar-header button {
    background: none;
    border: none;
    font-size: 1.25rem;
    cursor: pointer;
    color: var(--primary-blue);
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    transition: background-color 0.2s ease;
}

.calendar-header button:hover {
    background-color: #f3f4f6;
}

.calendar-header h2 {
    font-size: 1.1rem; /* Slightly increased font size for header */
    font-weight: 600;
    color: #333;
}

.calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 0.5rem;
    text-align: center;
}

.calendar-grid div {
    padding: 0.25rem 0.1rem; /* Optimized padding */
    font-size: 0.75rem;   /* Optimized font size */
    border-radius: 0.5rem;
    cursor: pointer;
    transition: background-color 0.2s ease, color 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 2rem; /* Explicit height for consistency */
}

.calendar-grid div.day-name {
    font-weight: 600;
    color: #555;
    cursor: default;
}

.calendar-grid div:not(.day-name):hover:not(.disabled) {
    background-color: #e0e7ff; /* Light blue hover */
}

.calendar-grid div.today {
    background-color: var(--light-blue);
    color: white;
    font-weight: 600;
}

.calendar-grid div.selected {
    background-color: var(--primary-blue);
    color: white;
    font-weight: 600;
}

.calendar-grid div.disabled {
    color: #ccc;
    cursor: not-allowed;
    background-color: #f9f9f9;
}

.calendar-grid div.sunday {
    color: #ef4444; /* Red for Sundays */
}

/* Responsive adjustments for calendar popup */
@media (min-width: 768px) { /* Desktop and larger screens */
    .calendar-popup {
        width: 350px; /* Fixed width for desktop */
        left: 0; /* Align to the left of the input */
        transform: translateY(10px); /* Only translateY for opening animation */
    }
    .calendar-popup.is-open {
        transform: translateY(0);
    }
}

@media (max-width: 767px) { /* Tablet and smaller screens */
    .calendar-popup {
        width: 100%; /* Full width of its parent container */
        left: 0; /* Align to the left of the input */
        transform: translateY(10px); /* Only translateY for opening animation */
    }
    .calendar-popup.is-open {
        transform: translateY(0);
    }
}

/* Styles for service selection buttons */
.service-button {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    padding: 0.75rem 1rem;
    background-color: #fff;
    border: 1px solid #d1d5db;
    border-radius: 0.75rem;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    font-weight: 500;
    color: #333;
    cursor: pointer;
    transition: all 0.2s ease-in-out;
}

.service-button:hover {
    border-color: #6366f1;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
}

.service-button.active {
    border-color: var(--primary-blue);
    box-shadow: 0 0 0 3px rgba(1, 2, 69, 0.2);
    background-color: #e0e7ff; /* Light blue background when active */
}

.service-button .arrow-icon {
    transition: transform 0.2s ease-in-out;
}

.service-button.active .arrow-icon {
    transform: rotate(90deg);
}

.sub-options-container {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
    opacity: 0;
    padding-left: 1rem; /* Indent sub-options */
    margin-top: 0.5rem;
}

.sub-options-container.is-open {
    max-height: 300px; /* Adjust as needed to fit content */
    opacity: 1;
}

.sub-option-item {
    padding: 0.5rem 0.75rem;
    background-color: #f9fafb;
    border-radius: 0.5rem;
    margin-bottom: 0.25rem;
    cursor: pointer;
    transition: background-color 0.2s ease-in-out;
    color: #555;
}

.sub-option-item:hover {
    background-color: #eef2ff; /* Lighter blue hover */
}

.sub-option-item.selected {
    background-color: #dbeafe; /* Even lighter blue when selected */
    color: var(--primary-blue);
    font-weight: 600;
}

/* Form visibility animation */
.form-hidden {
    max-height: 0;
    opacity: 0;
    overflow: hidden;
    transition: max-height 0.5s ease-in-out, opacity 0.5s ease-in-out;
}

.form-visible {
    max-height: 15000px; /* Increased to ensure it contains all form content */
    opacity: 1;
    transition: max-height 0.7s ease-in-out, opacity 0.7s ease-in-out;
}

/* Styles for the main booking card container */
.booking-card-container {
    transition: max-height 0.7s ease-in-out, padding 0.7s ease-in-out; /* Transition max-height and padding */
    overflow: hidden; /* Hide overflow during transition */
}
/* The max-height will be dynamically set by JavaScript */
/* Initial state for the booking card, showing patient type selection */
.booking-card-initial {
    max-height: 400px; /* A reasonable initial height to show buttons and title */
}

/* State when client ID input is visible */
.booking-card-client-id-visible {
    max-height: 700px; /* Adjust as needed to fit client ID section */
}

/* State when the main booking form is visible, allowing the card to expand fully */
.booking-card-expanded {
    max-height: 15000px; /* Very large value to allow full content expansion */
}

/* New styles for the booking confirmation modal */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.4); /* Semi-transparent dark background */
    backdrop-filter: blur(8px); /* Frosted glass effect */
    z-index: 10000; /* Ensure it's on top of everything */
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
}

.modal-overlay.is-visible {
    opacity: 1;
    visibility: visible;
}

.modal-content {
    background-color: rgba(255, 255, 255, 0.9); /* Slightly transparent white */
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    text-align: center;
    max-width: 400px;
    width: 90%;
    transform: translateY(20px);
    opacity: 0;
    transition: transform 0.3s ease, opacity 0.3s ease;
    position: relative; /* For close button positioning */
}

.modal-overlay.is-visible .modal-content {
    transform: translateY(0);
    opacity: 1;
}

.modal-close-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    background: none;
    border: none;
    font-size: 24px;
    color: #888;
    cursor: pointer;
    transition: color 0.2s ease;
}

.modal-close-btn:hover {
    color: #333;
}

.modal-title {
    font-family: 'DM Serif Display', serif;
    font-size: 28px;
    color: var(--primary-blue);
    margin-bottom: 10px;
}

.modal-subtitle {
    font-size: 18px;
    color: #555;
    margin-bottom: 20px;
}

.modal-download-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background-color: var(--primary-blue);
    color: white;
    padding: 12px 25px;
    border-radius: 12px;
    font-weight: 600;
    text-decoration: none;
    transition: background-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
    box-shadow: 0 4px 15px rgba(1, 2, 69, 0.2); /* Shadow matching primary-blue */
}

.modal-download-btn:hover {
    background-color: var(--accent-blue);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(1, 2, 69, 0.3);
}

.modal-download-btn i {
    margin-right: 10px;
    font-size: 18px;
}

/* Loading Spinner Styles (Apple-like) */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(255, 255, 255, 0.8); /* Light semi-transparent background */
    backdrop-filter: blur(5px);
    z-index: 10001; /* Higher than modal overlay */
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
}

.loading-overlay.is-visible {
    opacity: 1;
    visibility: visible;
}

.spinner {
    width: 50px;
    height: 50px;
    border: 4px solid rgba(1, 2, 69, 0.2); /* Lighter, transparent navy border */
    border-top-color: var(--primary-blue); /* Use primary blue for a premium feel */
    border-radius: 50%;
    animation: spin 1s ease-in-out infinite; /* Smoother, more consistent spin */
    box-shadow: 0 0 15px rgba(1, 2, 69, 0.2); /* Subtle shadow for depth */
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.whatsapp-float {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 58px;
  height: 58px;
  background: #25d366; /* WhatsApp green (can swap with WAFA brand color) */
  border-radius: 50%;
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  cursor: pointer;
  transition: all 0.3s ease;
}

.whatsapp-float img {
  width: 28px;
  height: 28px;
}

/* Hover animation */
.whatsapp-float:hover {
  transform: scale(1.12) translateY(-3px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.3);
}

/* Tooltip styling */
.tooltip {
  position: absolute;
  right: 70px;
  background: #333;
  color: #fff;
  padding: 6px 10px;
  border-radius: 6px;
  font-size: 13px;
  opacity: 0;
  white-space: nowrap;
  pointer-events: none;
  transition: opacity 0.3s ease;
}

/* Tooltip arrow */
.tooltip::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 100%;
  margin-top: -6px;
  border-width: 6px;
  border-style: solid;
  border-color: transparent transparent transparent #333;
}

/* Show tooltip on hover */
.whatsapp-float:hover .tooltip {
  opacity: 1;
}
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-blue': '#010245',
                        'accent-blue': '#4c4e9e',
                        'light-blue': '#9b9bd1',
                        'sky-blue': '#4169E1',
                    },
                },
            },
        };
    </script>
</head>
<body class="overflow-x-hidden font-inter text-gray-800 bg-gray-50 scroll-smooth">

    <!-- Elegant WhatsApp Floating Button with Tooltip -->
<a href="https://wa.me/923295195096?text=Hello,%20I’d%20like%20to%20schedule%20an%20appointment%20at%20WAFA%20Dental%20Clinic." 
   class="fixed bottom-6 right-6 w-14 h-14 bg-[#010245] rounded-full shadow-lg flex items-center justify-center z-[1000] cursor-pointer transition-all duration-300 hover:scale-110 hover:-translate-y-1 hover:shadow-xl group" 
   target="_blank" 
   aria-label="Chat with WAFA Dental">
   <img src="images/apple.png" alt="WAFA Dental WhatsApp" class="w-7 h-7" />
   <span class="absolute right-[70px] bg-gray-800 text-white text-sm px-3 py-1.5 rounded-md whitespace-nowrap opacity-0 pointer-events-none transition-opacity duration-300 group-hover:opacity-100 before:content-[''] before:absolute before:top-1/2 before:left-full before:-mt-1.5 before:border-6 before:border-solid before:border-transparent before:border-l-gray-800">Chat with WAFA Dental Support</span>
</a>

    <!-- Header --> 
    <header class="fixed top-0 left-0 w-full z-50 bg-primary-blue shadow-xl">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between max-w-7xl"> 
            <!-- Logo and Clinic Name as a clickable link --> 
            <a href="index.html" class="flex items-center space-x-3" aria-label="Home"> 
                <img src="images/logo.png" alt="WAFA Dental Clinic Logo" class="w-8 h-7 rounded-full" decoding="async">
                <span class="text-xl font-medium text-white tracking-tight font-dm-serif">WAFA Dental Clinic</span> 
            </a>

            <!-- Desktop Navigation -->
            <nav id="desktop-nav" class="hidden md:flex items-center space-x-6 flex-nowrap">
                <a href="index.html#about" class="text-sm text-gray-200 hover:text-white transition-all duration-300 px-2.5 py-1.5 rounded-md hover:bg-white hover:bg-opacity-10">About</a>
                <a href="index.html#services" class="text-sm text-gray-200 hover:text-white transition-all duration-300 px-2.5 py-1.5 rounded-md hover:bg-white hover:bg-opacity-10">Services</a>
                <a href="index.html#features" class="text-sm text-gray-200 hover:text-white transition-all duration-300 px-2.5 py-1.5 rounded-md hover:bg-white hover:bg-opacity-10">Our Promise</a>
                <a href="index.html#inquiries" class="text-sm text-gray-200 hover:text-white transition-all duration-300 px-2.5 py-1.5 rounded-md hover:bg-white hover:bg-opacity-10">Contact</a>
                <a href="bookings.html" class="px-5 py-1.5 text-sm font-semibold rounded-lg shadow-md bg-white text-primary-blue border border-white transition-all duration-300 transform hover:scale-105 hover:shadow-lg active:scale-95 focus-visible:ring-2 focus-visible:ring-primary-blue focus-visible:ring-opacity-75">
                    Book Now
                </a>
            </nav>

            <!-- Mobile Navigation Toggle -->
            <button id="mobile-menu-button" class="md:hidden focus:outline-none relative z-20 w-8 h-6 flex flex-col justify-around items-center">
                <span class="block w-full h-0.5 bg-white rounded-full transition-all duration-300 ease-in-out"></span>
                <span class="block w-full h-0.5 bg-white rounded-full transition-all duration-300 ease-in-out"></span>
                <span class="block w-full h-0.5 bg-white rounded-full transition-all duration-300 ease-in-out"></span>
            </button>
        </div>

        <!-- Mobile Navigation Menu -->
        <div id="mobile-menu" class="bg-primary-blue transition-all duration-500 ease-in-out max-h-0 overflow-hidden opacity-0">
            <nav class="flex flex-col items-center space-y-4 py-4 px-6">
                <a href="index.html#about" class="text-base text-gray-200 hover:text-white transition-all duration-300 px-4 py-2 rounded-lg hover:bg-white hover:bg-opacity-10 w-full text-center" onclick="toggleMobileMenu()">About</a>
                <a href="index.html#services" class="text-base text-gray-200 hover:text-white transition-all duration-300 px-4 py-2 rounded-lg hover:bg-white hover:bg-opacity-10 w-full text-center" onclick="toggleMobileMenu()">Services</a>
                <a href="index.html#features" class="text-base text-gray-200 hover:text-white transition-all duration-300 px-4 py-2 rounded-lg hover:bg-white hover:bg-opacity-10 w-full text-center" onclick="toggleMobileMenu()">Our Promise</a>
                <a href="index.html#inquiries" class="text-base text-gray-200 hover:text-white transition-all duration-300 px-4 py-2 rounded-lg hover:bg-white hover:bg-opacity-10 w-full text-center" onclick="toggleMobileMenu()">Contact</a>
                <a href="bookings.html" class="px-6 py-3 font-semibold rounded-xl shadow-lg bg-white text-primary-blue border border-white transition-all duration-300 transform hover:scale-105 hover:shadow-xl active:scale-95 focus-visible:ring-2 focus-visible:ring-primary-blue focus-visible:ring-opacity-75 w-full text-center" onclick="toggleMobileMenu()">
                    Book Now
                </a>
            </nav>
        </div>
    </header>

    <main>
        <!-- Booking Section -->
        <section id="booking" class="relative container mx-auto px-6 py-24 md:py-40 fade-in">
            <div id="bookingCard" class="max-w-3xl mx-auto p-10 md:p-16 rounded-3xl shadow-2xl card-with-glass booking-card-container booking-card-initial">
                <div class="text-center relative p-2">
                    <button type="button" id="backToPatientTypeBtn" class="absolute top-0 left-0 w-8 h-8 rounded-full bg-primary-blue flex items-center justify-center shadow-md transition-all duration-300 transform hover:scale-110 focus:outline-none z-10 opacity-0 scale-0">
                        <i class="fas fa-arrow-left text-white text-xs"></i>
                    </button>
                    <h2 class="text-xl md:text-4xl font-normal text-primary-blue font-dm-serif text-center pt-6 mb-4">Book an Appointment</h2>
                    <p id="servicePrompt" class="mt-2 text-base text-gray-600 max-w-2xl mx-auto mb-12">
                        Choose a service and a convenient time slot to book your appointment.
                    </p>
                </div>

                <!-- Patient Type Selection -->
                <div id="patientTypeSelection" class="flex flex-col md:flex-row gap-4 justify-center mt-8 text-center">
                    <button type="button" id="firstTimePatientBtn" class="button-glass-white px-6 py-3 font-semibold rounded-xl shadow-md text-primary-blue hover:bg-opacity-80 transition-all duration-300 transform hover:scale-105">
                        First Time Patient
                    </button>
                    <button type="button" id="returningPatientBtn" class="button-glass-white px-6 py-3 font-semibold rounded-xl shadow-md text-primary-blue hover:bg-opacity-80 transition-all duration-300 transform hover:scale-105">
                        Returning Patient
                    </button>
                </div>
                
                <form id="bookingForm" class="space-y-8 form-hidden relative mx-auto" style="--delay: 0.3s;">
                    <!-- Updated Name fields to be First Name and Last Name -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="firstName" class="block text-sm font-medium text-gray-700 mb-1">First Name <span class="text-red-500">*</span></label>
                            <input type="text" id="firstName" name="firstName" class="apple-input block w-full" required>
                        </div>
                        <div>
                            <label for="lastName" class="block text-sm font-medium text-gray-700 mb-1">Last Name <span class="text-red-500">*</span></label>
                            <input type="text" id="lastName" name="lastName" class="apple-input block w-full" required>
                        </div>
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address <span class="text-red-500">*</span></label>
                        <input type="email" id="email" name="email" class="apple-input block w-full" required>
                    </div>
                    <div class="grid grid-cols-1 gap-6">
                        <div>
                            <label for="countryCodeInput" class="block text-sm font-medium text-gray-700 mb-1">Country Code <span class="text-red-500">*</span></label>
                            <div class="custom-dropdown-container w-full">
                                <input
                                    type="text"
                                    id="countryCodeInput"
                                    class="apple-input custom-dropdown-input w-full"
                                    placeholder="+92 (PK)"
                                    aria-haspopup="listbox"
                                    aria-expanded="false"
                                >
                                <input type="hidden" id="countryCode" name="countryCode" value="+92">
                                <svg class="custom-dropdown-icon w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                                <ul id="countryList" class="custom-dropdown-menu"></ul>
                            </div>
                        </div>
                        <div>
                            <label for="phoneNumber" class="block text-sm font-medium text-gray-700 mb-1">Phone Number <span class="text-red-500">*</span></label>
                            <input type="tel" id="phoneNumber" name="phoneNumber" class="apple-input block w-full" placeholder="3XX XXXXXXX" required>
                        </div>
                    </div>
                    <div id="servicesSection">
                        <label class="block text-sm font-medium text-gray-700 mb-4">Select a Service <span class="text-red-500">*</span></label>
                        <div id="mainServiceButtons" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Main service buttons will be rendered here by JavaScript -->
                        </div>
                        <input type="hidden" id="serviceHidden" name="service" required>
                    </div>

                    <!-- New section for Other / Previous Issues -->
                    <div>
                        <label for="Notes" class="block text-sm font-medium text-gray-700 mb-1">Other / Previous Issues (Optional)</label>
                        <textarea id="Notes" name="Notes" rows="3" class="apple-input block w-full" style="height: auto;"></textarea>
                    </div>

                    <div>
                        <label for="dateInput" class="block text-sm font-medium text-gray-700 mb-1">Date <span class="text-red-500">*</span></label>
                        <!-- Calendar will be attached to this input -->
                        <div class="calendar-container">
                            <input type="text" id="dateInput" name="date" class="apple-input block w-full cursor-pointer calendar-input" placeholder="Select a date" readonly aria-haspopup="dialog" aria-expanded="false" required>
                            <svg class="calendar-icon w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                            <div id="calendarPopup" class="calendar-popup">
                                <div class="calendar-header">
                                    <button type="button" id="prevMonth" aria-label="Previous Month"><</button>
                                    <h2 id="monthYear"></h2>
                                    <button type="button" id="nextMonth" aria-label="Next Month">></button>
                                </div>
                                <div id="calendarGrid" class="calendar-grid"></div>
                            </div>
                        </div>
                        <p class="mt-1 text-sm text-red-500">
                            We are <span class="underline">Closed</span> on Sundays
                        </p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Appointment Time <span class="text-red-500">*</span></label>
                        <div class="grid grid-cols-2 gap-2 md:gap-4"> <!-- Changed to grid-cols-2 for mobile, reduced gap -->
                            <div class="custom-dropdown-container w-full time-dropdown-field">
                                <label for="bookingHourInput" class="sr-only">Hours</label>
                                <div id="bookingHourInputWrapper" class="apple-input custom-dropdown-input-wrapper" aria-haspopup="listbox" aria-expanded="false">
                                    <input
                                        type="text"
                                        id="bookingHourInput"
                                        class="custom-dropdown-text-input text-sm"
                                        placeholder="Hours"
                                        readonly
                                    />
                                    <svg class="custom-dropdown-icon w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                                <input type="hidden" id="bookingHourHidden" name="bookingHour" required>
                                <ul id="bookingHourList" class="custom-dropdown-menu"></ul>
                            </div>
                            <div class="custom-dropdown-container w-full time-dropdown-field">
                                <label for="bookingMinuteInput" class="sr-only">Minutes</label>
                                <div id="bookingMinuteInputWrapper" class="apple-input custom-dropdown-input-wrapper" aria-haspopup="listbox" aria-expanded="false">
                                    <input
                                        type="text"
                                        id="bookingMinuteInput"
                                        class="custom-dropdown-text-input text-sm"
                                        placeholder="Minutes"
                                        readonly
                                    />
                                    <svg class="custom-dropdown-icon w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                                <input type="hidden" id="bookingMinuteHidden" name="bookingMinute" required>
                                <ul id="bookingMinuteList" class="custom-dropdown-menu"></ul>
                            </div>
                        </div>
                        <p id="selectedTimeDisplay" class="mt-2 text-center text-sm font-medium text-green-600" style="--delay: 0.4s;"></p>
                    </div>
                    <div id="availabilityMessage" class="mt-2 text-center text-sm font-medium text-red-500 hidden"></div>
                    <div class="g-recaptcha" data-sitekey="6LfGh8ArAAAAAPaLcU1FX-nE_nrufknfUfA49LEq" data-callback="onRecaptchaSuccess" data-expired-callback="onRecaptchaExpired"></div>
                    <!-- Inline comment for site key -->
                    <!-- The reCAPTCHA site key has been updated. -->
                    <div id="recaptchaError" class="text-red-500 text-sm mt-2 hidden">Please complete the reCAPTCHA.</div>

                    <button type="submit" id="confirmAppointmentBtn" class="w-full px-6 py-3 font-semibold text-white bg-primary-blue rounded-xl shadow-md hover:bg-accent-blue transition-colors duration-200">
                        Confirm Appointment
                    </button>
                    <!-- Loading and status messages -->
                    <div id="statusMessage" class="mt-4 text-center text-sm font-medium"></div>
                </form>
            </div>
        </section>

        <!-- Map and Business Hours Section -->
        <section id="location" class="relative container mx-auto px-6 py-16 md:py-24 min-h-[70vh] fade-in">
            <h2 class="text-2xl md:text-3xl font-normal text-center mb-8 font-dm-serif" style="--delay: 0.1s;">Our Location</h2>
            <div class="flex flex-col md:flex-row md:space-x-6 space-y-6 md:space-y-0 items-stretch">
                <!-- Map Card -->
                <div class="w-full md:w-2/3 p-4 sm:p-6 md:p-8 rounded-2xl shadow-xl bg-white bg-opacity-20 backdrop-blur-xl flex flex-col" style="--delay: 0.2s;">
                    <a href="https://www.google.com/maps/place/WAFA+Dental+Clinic/@33.6673337,73.0747596,17z/data=!3m1!4b1!4m6!3m5!1s0x38df957cc7644563:0x27a7ae2e6cda42ef!8m2!3d33.6673337!4d73.0747596!16s%2Fg%2F11xd1rytr0?entry=tts&g_ep=EgoyMDI1MDgyNS4wIPu8ASoASAFQAw%3D%3D&skid=3e4f1248-9eac-454b-81b2-2d7b8c2abadb" target="_blank" class="block cursor-pointer flex-grow" aria-label="Open WAFA Dental Clinic location in Google Maps">
                        <div class="overflow-hidden rounded-xl shadow-lg w-full h-full">
                            <iframe
                                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3320.088494056911!2d73.0721846!3d33.6673337!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x38df957cc7644563:0x27a7ae2e6cda42ef!2sWAFA%20Dental%20Clinic!5e0!3m2!1sen!2s!4v1725206263536!5m2!1sen!2s"
                                class="w-full h-full rounded-xl"
                                style="border:0;"
                                allowfullscreen=""
                                loading="lazy"
                                referrerpolicy="no-referrer-when-downgrade"
                                tabindex="-1">
                            </iframe>
                        </div>
                    </a>
                    <a href="https://www.google.com/maps/place/WAFA+Dental+Clinic/@33.6673337,73.0747596,17z/data=!3m1!4b1!4m6!3m5!1s0x38df957cc7644563:0x27a7ae2e6cda42ef!8m2!3d33.6673337!4d73.0747596!16s%2Fg%2F11xd1rytr0?entry=tts&g_ep=EgoyMDI1MDgyNS4wIPu8ASoASAFQAw%3D%3D&skid=3e4f1248-9eac-454b-81b2-2d7b8c2abadb" target="_blank" class="block mt-3 text-center text-xs text-gray-600 hover:underline">
                        Office #7, 3rd Floor, The Ark Building, Markaz, I-8 Markaz I 8 Markaz I-8, Islamabad, 44000, Pakistan
                    </a>
                </div>

                <!-- Business Hours Card -->
                <div class="w-full md:w-1/3 p-4 sm:p-6 md:p-8 rounded-2xl shadow-xl bg-white bg-opacity-20 backdrop-blur-xl flex flex-col justify-center items-center min-h-[400px]" style="--delay: 0.3s;">
                    <div class="flex items-center mb-4">
                        <i class="far fa-clock text-primary-blue text-base mr-2"></i>
                        <h3 class="text-xl font-dm-serif text-gray-900">Our Business Hours</h3>
                    </div>
                    <div class="text-sm flex flex-col items-center w-full">
                        <div class="grid grid-cols-2 gap-x-6 gap-y-2 text-sm w-full max-w-xs pl-4">
                            <div class="font-semibold text-gray-800 text-left">Monday</div>
                            <div class="whitespace-nowrap text-gray-700 text-left">4:00 PM - 9:00 PM</div>
                            <div class="font-semibold text-gray-800 text-left">Tuesday</div>
                            <div class="whitespace-nowrap text-gray-700 text-left">4:00 PM - 9:00 PM</div>
                            <div class="font-semibold text-gray-800 text-left">Wednesday</div>
                            <div class="whitespace-nowrap text-gray-700 text-left">4:00 PM - 9:00 PM</div>
                            <div class="font-semibold text-gray-800 text-left">Thursday</div>
                            <div class="whitespace-nowrap text-gray-700 text-left">4:00 PM - 9:00 PM</div>
                            <div class="font-semibold text-gray-800 text-left">Friday</div>
                            <div class="whitespace-nowrap text-gray-700 text-left">4:00 PM - 9:00 PM</div>
                            <div class="font-semibold text-gray-800 text-left">Saturday</div>
                            <div class="whitespace-nowrap text-gray-700 text-left">4:00 PM - 9:00 PM</div>
                            <div class="font-semibold text-gray-800 text-left">Sunday</div>
                            <div class="whitespace-nowrap text-gray-700 text-left">Closed</div>
                        </div>
                        <p class="block mt-6 text-center text-xs text-gray-600">
                            We are open from Mon-Sat · Hours: 4:00PM - 9:00PM. We are closed on Sundays.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- General Inquiries Section -->
        <section id="inquiries" class="relative container mx-auto px-6 py-16 md:py-24 fade-in">
            <!-- Increased max-w for overall card and adjusted padding -->
            <div class="max-w-2xl mx-auto p-6 md:p-8 rounded-2xl shadow-2xl bg-gradient-to-br from-white to-gray-50 bg-opacity-90 backdrop-blur-xl space-y-10">
                <div class="text-center">
                    <h2 class="text-2xl md:text-3xl font-dm-serif text-primary-blue" style="--delay: 0.1s;">General Inquiries</h2>
                    <p class="mt-1.5 text-base text-gray-600 max-w-xl mx-auto" style="--delay: 0.2s;">
                        Have a question? Fill out the form below or contact us directly.
                    </p>
                </div>
                
                <!-- Reduced the gap on medium screens to give more room -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
                    <!-- Form Column -->
                    <!-- Updated form with id for JavaScript handling -->
                    <form id="contactForm" class="space-y-5 p-5 bg-white rounded-xl shadow-lg" style="--delay: 0.3s;">
                        <div>
                            <label for="inquiries_name" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                            <input type="text" id="inquiries_name" name="name" class="block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-blue focus:border-transparent transition-all duration-200">
                        </div>
                        <div>
                            <label for="inquiries_email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                            <input type="email" id="inquiries_email" name="email" class="block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-blue focus:border-transparent transition-all duration-200">
                        </div>
                        <div>
                            <label for="inquiries_subject" class="block text-sm font-medium text-gray-700 mb-1">Subject</label>
                            <input type="text" id="inquiries_subject" name="subject" class="block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-blue focus:border-transparent transition-all duration-200">
                        </div>
                        <div>
                            <label for="inquiries_message" class="block text-sm font-medium text-gray-700 mb-1">Message</label>
                            <textarea id="inquiries_message" name="message" rows="3" class="block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-blue focus:border-transparent transition-all duration-200"></textarea>
                        </div>
                        <button type="submit" class="w-full px-5 py-2.5 font-semibold text-white bg-primary-blue rounded-xl shadow-md hover:bg-accent-blue transition-colors duration-200 transform hover:-translate-y-0.5 hover:shadow-lg">
                            Send Message
                        </button>
                    </form>

                    <!-- Contact Info Column -->
                    <div class="space-y-5 md:mt-8" style="--delay: 0.4s;">
                        <div class="p-5 rounded-xl bg-white bg-opacity-70 shadow-lg">
                            <h3 class="text-lg font-dm-serif mb-2.5 text-gray-900">Get in Touch Directly</h3>
                            <div class="space-y-2.5">
                                <!-- Adjusted font size for links to prevent overflow and added whitespace-nowrap -->
                                <a href="mailto:management@wafadentalclinic.com" class="flex items-center space-x-2.5 text-gray-700 hover:text-sky-blue transition-colors whitespace-nowrap">
                                    <i class="fas fa-envelope text-sky-blue text-xs flex-shrink-0"></i>
                                    <span class="text-xs">management@wafadentalclinic.com</span>
                                </a>
                                <a href="tel:+92518448877" class="flex items-center space-x-2.5 text-gray-700 hover:text-sky-blue transition-colors whitespace-nowrap">
                                    <i class="fas fa-phone-alt text-sky-blue text-xs"></i>
                                    <span class="text-xs">+92 51 8448877</span>
                                </a>
                                <a href="https://wa.me/923295195096" class="flex items-center space-x-2.5 text-gray-700 hover:text-sky-blue transition-colors whitespace-nowrap">
                                    <i class="fab fa-whatsapp text-sky-blue text-xs"></i>
                                    <span class="text-xs">+92 329 5195096</span>
                                </a>
                            </div>
                        </div>
                        <div class="p-5 rounded-xl bg-white bg-opacity-70 shadow-lg">
                            <h3 class="text-lg font-dm-serif mb-2.5 text-gray-900">Book an Appointment</h3>
                            <p class="text-sm text-gray-700">
                                <!-- Added a hyperlink to "Click Here" -->
                                To schedule an appointment <a href="#booking" class="text-sky-blue hover:underline">Click Here</a> or contact us via phone or WhatsApp during our business hours.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-primary-blue py-12">
        <div class="container mx-auto px-6 text-gray-300">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-base font-dm-serif text-white mb-4">WAFA Dental Clinic</h3>
                    <p class="text-xs">
                        <!-- Make the address clickable -->
                        <a href="https://www.google.com/maps/place/WAFA+Dental+Clinic/@33.6673337,73.0747596,17z/data=!3m1!4b1!4m6!3m5!1s0x38df957cc7644563:0x27a7ae2e6cda42ef!8m2!3d33.6673337!4d73.0747596!16s%2Fg%2F11xd1rytr0?entry=tts&g_ep=EgoyMDI1MDgyNS4wIPu8ASoASAFQAw%3D%3D&skid=3e4f1248-9eac-454b-81b2-2d7b8c2abadb" target="_blank" class="hover:text-white transition-colors duration-200">
                            Office #7 · 3rd Floor · The Ark Building · I-8 Markaz <br> Islamabad 44000 · Pakistan
                        </a>
                    </p>
                </div>
                <div>
                    <h3 class="text-base font-dm-serif text-white mb-4">About Us</h3>
                    <ul class="space-y-2">
                        <li><a href="index.html#services" class="text-xs hover:text-white transition-colors duration-200">Our Services</a></li>
                        <li><a href="our-story.html" class="text-xs hover:text-white transition-colors duration-200">Our Story</a></li>
                        <li><a href="careers.html" class="text-xs hover:text-white transition-colors duration-200">Careers</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-base font-dm-serif text-white mb-4">Follow Us</h3>
                    <div class="flex flex-col space-y-2 text-xs">
                        <a href="https://www.facebook.com/wafadentalclinics" target="_blank" rel="noopener noreferrer" class="text-gray-300 hover:text-white transition-colors duration-200" aria-label="Facebook">
                            Facebook
                        </a>
                        <a href="https://www.instagram.com/wafadentalclinic.pk/" target="_blank" rel="noopener noreferrer" class="text-gray-300 hover:text-white transition-colors duration-200" aria-label="Instagram">
                            Instagram
                        </a>
                        <a href="https://www.linkedin.com/company/wafa-dental-clinic/" target="_blank" rel="noopener noreferrer" class="text-gray-300 hover:text-white transition-colors duration-200" aria-label="LinkedIn" >
                            LinkedIn
                        </a>
                        <a href="https://x.com/TeamWafaDental" target="_blank" rel="noopener noreferrer" class="text-gray-300 hover:text-white transition-colors duration-200" aria-label="Twitter" >
                            Twitter
                        </a>
                        <a href="https://www.youtube.com/@WAFADentalClinic" target="_blank" rel="noopener noreferrer" class="text-gray-300 hover:text-white transition-colors duration-200" aria-label="YouTube" >
                            YouTube
                        </a>
                        <a href="https://www.tiktok.com/@wafadental" target="_blank" rel="noopener noreferrer" class="text-gray-300 hover:text-white transition-colors duration-200" aria-label="TikTok" >
                            TikTok
                        </a>
                    </div>
                </div>
                <div>
                    <h3 class="text-base font-dm-serif text-white mb-4">Legal</h3>
                    <ul class="space-y-2">
                        <li><span class="text-xs hover:text-white transition-colors duration-200 cursor-pointer">Legal</span></li>
                        <li><span class="text-xs hover:text-white transition-colors duration-200 cursor-pointer">Privacy Policy</span></li>
                        <li><span class="text-xs hover:text-white transition-colors duration-200 cursor-pointer">Terms and Conditions</span></li>
                    </ul>
                </div>
            </div>
            <hr class="my-8 border-gray-700">
            <div class="text-center text-xs text-gray-400">
                &copy; <span id="current-year"></span> WAFA Dental Clinic. All rights reserved.
            </div>
        </div>
    </footer>

    <script>
        // --- IMPORTANT: CONFIGURATION VARIABLES ---
        // Please replace these placeholder values with your actual data.
        const TIMEZONE = "Asia/Islamabad";
        const SHEET_NAME = "WAFA Bookings";
        const SHEET_COLUMNS = ["Client ID","Booking ID","Name","Email","Phone","Service","Date","Time","Calendar Event ID","Doc URL","Created At"];
        const CALENDAR_ID = "wafadentalclinics@gmail.com";
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzKvdmTP9E84h0xmnZqqk2v485GbgpJfIwt_H79rp5J6LwJYWP9yHXp-M-OwoCP7HIi/exec";
        const COUNTRIES = [
            // Key English-speaking countries
            { code: "+1", name: "United States", iso: "USA", placeholder: "XXX XXX XXXX" },
            { code: "+44", name: "United Kingdom", iso: "GBR", placeholder: "XXXX XXX XXXX" },
            { code: "+1", name: "Canada", iso: "CAN", placeholder: "XXX XXX XXXX" },
            { code: "+61", name: "Australia", iso: "AUS", placeholder: "X XXXX XXXX" },
            { code: "+49", name: "Germany", iso: "DEU", placeholder: "XXXX XXXXXXX" },
            { code: "+33", name: "France", iso: "FRA", placeholder: "X XX XX XX XX" },
            { code: "+64", name: "New Zealand", iso: "NZL", placeholder: "XXX XXX XXXX" },
            { code: "+353", name: "Ireland", iso: "IRL", placeholder: "XXX XXX XXXX" },
            { code: "+41", name: "Switzerland", iso: "CHE", placeholder: "XX XXX XX XX" },
            { code: "+46", name: "Sweden", iso: "SWE", placeholder: "XX XXX XX XX" },
            { code: "+31", name: "Netherlands", iso: "NLD", placeholder: "X XXX XXX XXX" },
            { code: "+81", name: "Japan", iso: "JPN", placeholder: "XX XXXX XXXX" },
            { code: "+65", name: "Singapore", iso: "SGP", placeholder: "XXXX XXXX" },
            { code: "+82", name: "South Korea", iso: "KOR", placeholder: "XX XXXX XXXX" },

            // Key Source Markets (Asia)
            { code: "+86", name: "China", iso: "CHN", placeholder: "XXX XXXX XXXX" },
            { code: "+91", name: "India", iso: "IND", placeholder: "XXXXX XXXXX" },
            { code: "+92", name: "Pakistan", iso: "PK", placeholder: "3XX XXXXXXX" },
            { code: "+880", name: "Bangladesh", iso: "BGD", placeholder: "XXXX XXXXXX" },
            { code: "+977", name: "Nepal", iso: "NPL", placeholder: "XX XXXXXXX" },
            { code: "+94", name: "Sri Lanka", iso: "LKA", placeholder: "XX XXX XXXX" },
            { code: "+84", name: "Vietnam", iso: "VNM", placeholder: "XXX XXX XXXX" },
            { code: "+62", name: "Indonesia", iso: "IDN", placeholder: "XXX XXX XXXX" },
            { code: "+60", name: "Malaysia", iso: "MYS", placeholder: "XX XXX XXXX" },
            { code: "+66", name: "Thailand", iso: "THA", placeholder: "XX XXX XXXX" },
            { code: "+63", name: "Philippines", iso: "PHL", placeholder: "XXX XXX XXXX" },

            // Key Source Markets (Middle East & Africa)
            { code: "+971", name: "United Arab Emirates", iso: "ARE", placeholder: "XX XXX XXXX" },
            { code: "+966", name: "Saudi Arabia", iso: "SAU", placeholder: "XX XXX XXXX" },
            { code: "+974", name: "Qatar", iso: "QAT", placeholder: "XXXX XXXX" },
            { code: "+965", name: "Kuwait", iso: "KWT", placeholder: "XXXX XXXX" },
            { code: "+968", name: "Oman", iso: "OMN", placeholder: "XXXX XXXX" },
            { code: "+973", name: "Bahrain", iso: "BHR", placeholder: "XXXX XXXX" },
            { code: "+90", name: "Turkey", iso: "TUR", placeholder: "XXX XXX XXXX" },
            { code: "+20", name: "Egypt", "iso": "EGY", placeholder: "XXX XXX XXXX" },
            { code: "+234", name: "Nigeria", iso: "NGA", placeholder: "XXX XXX XXXX" },
            { code: "+233", name: "Ghana", iso: "GHA", placeholder: "XX XXX XXXX" },
            { code: "+254", name: "Kenya", iso: "KEN", placeholder: "XXX XXX XXXX" },
            { code: "+27", name: "South Africa", iso: "ZAF", placeholder: "XX XXX XXXX" },
            { code: "+212", name: "Morocco", iso: "MAR", placeholder: "XXX XXXXXX" },

            // Key Source Markets (Europe)
            { code: "+7", name: "Russia", iso: "RUS", placeholder: "XXX XXX XX XX" },
            { code: "+39", name: "Italy", iso: "ITA", placeholder: "XXX XXXXXXX" },
            { code: "+34", name: "Spain", iso: "ESP", placeholder: "XXX XX XX XX" },
            { code: "+40", name: "Romania", iso: "ROU", placeholder: "XXX XXX XXX" },
            { code: "+380", name: "Ukraine", iso: "UKR", placeholder: "XX XXX XX XX" },

            // Key Source Markets (Americas)
            { code: "+55", name: "Brazil", iso: "BRA", placeholder: "XX XXXXX XXXX" },
            { code: "+52", name: "Mexico", iso: "MEX", placeholder: "XXX XXX XXXX" },
            { code: "+57", name: "Colombia", iso: "COL", placeholder: "XXX XXX XXXX" },
            { code: "+54", name: "Argentina", iso: "ARG", placeholder: "XXX XXX XXXX" }
        ];

        // Define toggleMobileMenu function to close mobile menu when a link is clicked
        function toggleMobileMenu() {
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            if (mobileMenu.classList.contains('is-open')) {
                mobileMenu.classList.remove('is-open');
                mobileMenuButton.classList.remove('is-open');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            // --- Mobile Menu Toggle ---
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');

            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('is-open');
                mobileMenuButton.classList.toggle('is-open'); // Add a class to the button itself for animation
            });

            // --- Smooth Scrolling for Anchor Links ---
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    document.querySelector(this.getAttribute('href')).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });

            // --- Scroll-based Fade-in Animation ---
            const fadeInSections = document.querySelectorAll('.fade-in');
            const observerOptions = {
                root: null, // relative to the viewport
                rootMargin: '0px',
                threshold: 0.1 // 10% of the item is visible
            };

            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                        observer.unobserve(entry.target); // Stop observing once it's visible
                    }
                });
            }, observerOptions);

            fadeInSections.forEach(section => {
                observer.observe(section);
            });

            // --- Auto-update Footer Year ---
            const currentYearSpan = document.getElementById('current-year');
            currentYearSpan.textContent = new Date().getFullYear();

            // --- General Inquiries Form Submission (Mailto) ---
            // This form is not present in bookings.html, so this block can be removed or commented out if not needed.
            // const contactForm = document.getElementById('contactForm');
            // const recipientEmail = 'management@wafadentalclinic.com'; // You can change this email address

            // contactForm.addEventListener('submit', (e) => {
            //     e.preventDefault(); // Prevent the default form submission

            //     // Get form values
            //     const name = document.getElementById('inquiries_name').value;
            //     const email = document.getElementById('inquiries_email').value;
            //     const subject = document.getElementById('inquiries_subject').value;
            //     const message = document.getElementById('inquiries_message').value;

            //     // Construct a clean, readable body text
            //     const bodyText = `Name: ${name}\nEmail: ${email}\n\nMessage:\n${message}`;

            //     // Create the mailto link with encoded subject and body
            //     const mailtoLink = `mailto:${recipientEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(bodyText)}`;

            //     // Redirect to the mailto link
            //     window.location.href = mailtoLink;
            // });
            
            // --- Patient Type Selection Logic ---
            const patientTypeSelection = document.getElementById('patientTypeSelection');
            const firstTimePatientBtn = document.getElementById('firstTimePatientBtn');
            const returningPatientBtn = document.getElementById('returningPatientBtn');
            const servicePrompt = document.getElementById('servicePrompt');
            const bookingForm = document.getElementById('bookingForm');
            const statusMessage = document.getElementById('statusMessage');
            const clientIDSection = document.createElement('div');
            clientIDSection.innerHTML = `
                <div>
                    <label for="clientID" class="block text-sm font-medium text-gray-700 mb-1">Client ID</label>
                    <input type="text" id="clientID" name="clientID" class="apple-input block w-full" placeholder="Enter your Client ID">
                </div>
                <button type="button" id="submitClientIDBtn" class="w-full px-6 py-3 font-semibold text-white bg-primary-blue rounded-xl shadow-md hover:bg-accent-blue transition-colors duration-200 mt-4">
                    Submit Client ID
                </button>
            `;
            clientIDSection.classList.add('space-y-6', 'hidden'); // Initially hidden

            // Insert clientIDSection right after patientTypeSelection
            patientTypeSelection.parentNode.insertBefore(clientIDSection, bookingForm);

            // Add a class to the bookingForm for smooth animation
            bookingForm.classList.add('form-hidden'); // Keep form hidden initially

            const backToPatientTypeBtn = document.getElementById('backToPatientTypeBtn');
            // Initially hide the back button using opacity and scale for animation
            backToPatientTypeBtn.classList.add('opacity-0', 'scale-0');

            const bookingCard = document.getElementById('bookingCard'); // Get the booking card element

            const showPatientTypeSelection = () => {
                patientTypeSelection.classList.remove('hidden');
                clientIDSection.classList.add('hidden', 'form-hidden');
                bookingForm.classList.add('form-hidden');
                bookingForm.classList.remove('form-visible');
                servicePrompt.classList.remove('is-visible'); // Hide the prompt when going back
                backToPatientTypeBtn.classList.add('opacity-0', 'scale-0'); // Hide back button with animation
                bookingForm.reset();
                serviceHidden.value = '';
                if (selectedSubOption) {
                    selectedSubOption.classList.remove('selected');
                    selectedSubOption.querySelector('.fa-check-circle').classList.remove('opacity-100', 'scale-100');
                    selectedSubOption = null;
                }
                updateSelectedTimeDisplay();
                // Ensure serviceHidden and selectedSubOption are cleared when going back
                serviceHidden.value = '';
                selectedSubOption = null;
                // Reset dropdowns and calendar
                selectedCountry = defaultCountry; // Reset selectedCountry to default
                countryCodeInput.value = `${defaultCountry.code} (${defaultCountry.iso})`;
                countryCodeHidden.value = defaultCountry.code;
                renderCountries(); // Re-render to ensure default is highlighted
                bookingHourInput.value = '';
                bookingHourHidden.value = '';
                bookingMinuteInput.value = '';
                bookingMinuteHidden.value = '';
                dateInput.value = selectedDate.toLocaleDateString("en-US", { year: "numeric", month: "2-digit", day: "2-digit" });
                renderCalendar(currentMonth, currentYear);
                // Close any open dropdowns
                toggleDropdown(false, countryCodeInput, countryList);
                toggleDropdown(false, bookingHourInput, bookingHourList);
                toggleDropdown(false, bookingMinuteInput, bookingMinuteList);
                calendarPopup.classList.remove('is-open');
                dateInput.setAttribute('aria-expanded', 'false');

                // Adjust bookingCard classes
                bookingCard.classList.add('booking-card-initial');
                bookingCard.classList.remove('booking-card-client-id-visible', 'booking-card-expanded');
            };

            firstTimePatientBtn.addEventListener('click', () => {
                patientTypeSelection.classList.add('hidden');
                clientIDSection.classList.add('hidden', 'form-hidden'); // Ensure client ID section is hidden and animated
                bookingForm.classList.remove('form-hidden'); // Animate form to visible
                bookingForm.classList.add('form-visible');
                servicePrompt.classList.add('is-visible'); // Show the prompt
                backToPatientTypeBtn.classList.remove('opacity-0', 'scale-0'); // Show back button with animation
                // Reset form for new patient
                bookingForm.reset();
                serviceHidden.value = '';
                if (selectedSubOption) {
                    selectedSubOption.classList.remove('selected');
                    selectedSubOption.querySelector('.fa-check-circle').classList.remove('opacity-100', 'scale-100');
                    selectedSubOption = null;
                }
                updateSelectedTimeDisplay();
                // Reset dropdowns and calendar
                countryCodeInput.value = `${defaultCountry.code} (${defaultCountry.iso})`;
                countryCodeHidden.value = defaultCountry.code;
                bookingHourInput.value = '';
                bookingHourHidden.value = '';
                bookingMinuteInput.value = '';
                bookingMinuteHidden.value = '';
                dateInput.value = selectedDate.toLocaleDateString("en-US", { year: "numeric", month: "2-digit", day: "2-digit" });
                renderCalendar(currentMonth, currentYear);

                // Adjust bookingCard classes
                bookingCard.classList.add('booking-card-expanded');
                bookingCard.classList.remove('booking-card-initial', 'booking-card-client-id-visible');
            });

            returningPatientBtn.addEventListener('click', () => {
                patientTypeSelection.classList.add('hidden');
                clientIDSection.classList.remove('hidden', 'form-hidden'); // Show client ID input and submit button
                clientIDSection.classList.add('form-visible'); // Animate clientIDSection
                bookingForm.classList.add('form-hidden'); // Ensure booking form is hidden initially
                bookingForm.classList.remove('form-visible'); // Remove visible class if it was there
                servicePrompt.classList.add('is-visible'); // Show the prompt
                backToPatientTypeBtn.classList.remove('opacity-0', 'scale-0'); // Show back button with animation
                // Clear form for returning patient to enter ID
                bookingForm.reset();
                serviceHidden.value = '';
                if (selectedSubOption) {
                    selectedSubOption.classList.remove('selected');
                    selectedSubOption.querySelector('.fa-check-circle').classList.remove('opacity-100', 'scale-100');
                    selectedSubOption = null;
                }
                updateSelectedTimeDisplay();
                // Reset dropdowns and calendar
                countryCodeInput.value = `${defaultCountry.code} (${defaultCountry.iso})`;
                countryCodeHidden.value = defaultCountry.code;
                bookingHourInput.value = '';
                bookingHourHidden.value = '';
                bookingMinuteInput.value = '';
                bookingMinuteHidden.value = '';
                dateInput.value = selectedDate.toLocaleDateString("en-US", { year: "numeric", month: "2-digit", day: "2-digit" });
                renderCalendar(currentMonth, currentYear);

                // Adjust bookingCard classes
                bookingCard.classList.add('booking-card-client-id-visible');
                bookingCard.classList.remove('booking-card-initial', 'booking-card-client-id-visible');
            });

            backToPatientTypeBtn.addEventListener('click', () => {
                showPatientTypeSelection();
            });

            const submitClientIDBtn = clientIDSection.querySelector('#submitClientIDBtn');
            const clientIDInput = clientIDSection.querySelector('#clientID');

            submitClientIDBtn.addEventListener('click', () => {
                const clientID = clientIDInput.value;
                if (clientID === '12345') { // Example Client ID
                    document.getElementById('firstName').value = 'John';
                    document.getElementById('lastName').value = 'Doe';
                    document.getElementById('email').value = 'john.doe@example.com';
                    document.getElementById('phoneNumber').value = '3001234567';
                    // Keep service and date/time blank as per requirements
                    clientIDSection.classList.remove('form-visible'); // Hide client ID section
                    clientIDSection.classList.add('form-hidden');
                    bookingForm.classList.remove('form-hidden'); // Show form
                    bookingForm.classList.add('form-visible'); // Animate form
                    // Adjust bookingCard classes
                    bookingCard.classList.add('booking-card-expanded');
                    bookingCard.classList.remove('booking-card-initial', 'booking-card-client-id-visible');
                } else {
                    // Clear fields if ID is invalid
                    document.getElementById('firstName').value = '';
                    document.getElementById('lastName').value = '';
                    document.getElementById('email').value = '';
                    document.getElementById('phoneNumber').value = '';
                    alert('Invalid Client ID. Please try again.'); // Simple alert for demo
                }
            });


            bookingForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                // Clear previous messages
                statusMessage.textContent = '';
                statusMessage.classList.remove('text-red-500', 'text-green-500');

                // Get values from the new separate fields
                const firstName = document.getElementById('firstName').value;
                const lastName = document.getElementById('lastName').value;
                const name = `${firstName} ${lastName}`;
                const email = document.getElementById('email').value;
                const countryCode = document.getElementById('countryCode').value;
                const phoneNumber = document.getElementById('phoneNumber').value;
                const service = document.getElementById('serviceHidden').value; // Get value from hidden input
                const date = document.getElementById('dateInput').value; // Changed to dateInput
                const bookingHour = document.getElementById('bookingHourHidden').value;
                const bookingMinute = document.getElementById('bookingMinuteHidden').value;
                const time = `${bookingHour}:${bookingMinute}`;
                const notes = document.getElementById("Notes").value;

                // Combine the country code and phone number
                const phone = countryCode + ' ' + phoneNumber;
                const recaptchaResponse = grecaptcha.getResponse();
                const recaptchaErrorDiv = document.getElementById('recaptchaError');

                // Basic validation
                if (!firstName || !lastName || !email || !phone || !service || !date || !bookingHour || !bookingMinute) {
                    statusMessage.textContent = 'Please fill out all fields.';
                    statusMessage.classList.add('text-red-500');
                    return;
                }

                // reCAPTCHA validation
                if (recaptchaResponse.length === 0) {
                    recaptchaErrorDiv.classList.remove('hidden');
                    statusMessage.textContent = 'Please complete the reCAPTCHA.';
                    statusMessage.classList.add('text-red-500');
                    return;
                } else {
                    recaptchaErrorDiv.classList.add('hidden');
                }

                // Construct date string in YYYY-MM-DD format for consistent parsing
                const [month, day, year] = date.split('/');
                const formattedDate = `${year}-${month}-${day}`;
                const selectedDate = new Date(`${formattedDate}T${bookingHour}:${bookingMinute}:00`);
                const dayOfWeek = selectedDate.getDay(); // 0 for Sunday, 1 for Monday...

                // Check for Sunday
                if (dayOfWeek === 0) {
                    statusMessage.textContent = 'Appointments are not available on Sundays.';
                    statusMessage.classList.add('text-red-500');
                    return;
                }

                // Check for valid time range (4:00 PM to 9:00 PM)
                const startTime = 16; // 4:00 PM
                const endTime = 21; // 9:00 PM
                const selectedHour = parseInt(bookingHour, 10);
                const selectedMinutes = parseInt(bookingMinute, 10);

                if (selectedHour < startTime || selectedHour >= endTime || (selectedHour === endTime && selectedMinutes > 0)) {
                    statusMessage.textContent = 'Please select a time between 4:00 PM and 9:00 PM.';
                    statusMessage.classList.add('text-red-500');
                    return;
                }

                // Disable submit button to prevent double submission
                submitButton.disabled = true;
                // Show loading overlay
                loadingOverlay.classList.add('is-visible');
                statusMessage.textContent = 'Booking your appointment...';
                statusMessage.classList.add('text-gray-500');

                const data = { // Renamed to 'data' to match user's script
                    FirstName: firstName,
                    LastName: lastName,
                    Email: email,
                    Phone: phone,
                    Service: service,
                    Date: date,
                    Time: time,
                    Notes: notes,
                    RecaptchaResponse: recaptchaResponse // Send reCAPTCHA response to server
                };
                
                // Google Apps Script expects application/x-www-form-urlencoded for e.parameter
                const urlEncodedData = new URLSearchParams(data).toString();

                try {
                    const fetchResponse = await fetch(WEB_APP_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: urlEncodedData
                    });

                    const result = await fetchResponse.json();

                    if (result.success) {
                        // ** NEW: Send data to our backend for email attachment **
                        sendConfirmationEmailWithAttachment(data, result);

                        // Clear the status message
                        statusMessage.textContent = '';
                        statusMessage.classList.remove('text-gray-500');

                        // Hide loading overlay and show confirmation modal
                        loadingOverlay.classList.remove('is-visible');
                        confirmationModal.classList.add('is-visible');
                        
                        // Handle PDF download from the base64 string
                        if (result.pdfBase64) {
                            const byteCharacters = atob(result.pdfBase64);
                            const byteNumbers = new Array(byteCharacters.length);
                            for (let i = 0; i < byteCharacters.length; i++) {
                                byteNumbers[i] = byteCharacters.charCodeAt(i);
                            }
                            const byteArray = new Uint8Array(byteNumbers);
                            const pdfBlob = new Blob([byteArray], { type: 'application/pdf' });
                            const pdfUrl = URL.createObjectURL(pdfBlob);
                            
                            const tempLink = document.createElement('a');
                            tempLink.href = pdfUrl;
                            tempLink.download = `WAFA_Medical_Receipt_${result.bookingID}_${result.clientID}.pdf`;
                            document.body.appendChild(tempLink);
                            tempLink.click();
                            document.body.removeChild(tempLink);
                            
                            setTimeout(() => URL.revokeObjectURL(pdfUrl), 100);
                        } else {
                            console.error("PDF base64 string not received.");
                        }

                        bookingForm.reset();
                        if (typeof grecaptcha !== 'undefined') { grecaptcha.reset(); }
                        // Clear selected service and time display
                        serviceHidden.value = '';
                        if (selectedSubOption) {
                            selectedSubOption.classList.remove('selected');
                            selectedSubOption.querySelector('.fa-check-circle').classList.remove('opacity-100', 'scale-100');
                            selectedSubOption = null;
                        }
                        updateSelectedTimeDisplay();

                    } else {
                        loadingOverlay.classList.remove('is-visible');
                        statusMessage.textContent = "Error: " + result.message;
                        statusMessage.classList.add('text-red-500');
                        if (typeof grecaptcha !== 'undefined') { grecaptcha.reset(); }
                    }
                } catch (error) {
                    loadingOverlay.classList.remove('is-visible');
                    console.error('Error submitting form:', error);
                    statusMessage.textContent = "Error: Could not connect to the booking service. Please try again.";
                    statusMessage.classList.add('text-red-500');
                    if (typeof grecaptcha !== 'undefined') { grecaptcha.reset(); }
                } finally {
                    // Re-enable submit button
                    submitButton.disabled = false;
                }
            });

            // reCAPTCHA callback functions
            window.onRecaptchaSuccess = () => {
                document.getElementById('recaptchaError').classList.add('hidden');
            };

            window.onRecaptchaExpired = () => {
                if (typeof grecaptcha !== 'undefined') { grecaptcha.reset(); }
                document.getElementById('recaptchaError').classList.remove('hidden');
                document.getElementById('recaptchaError').textContent = 'reCAPTCHA expired. Please complete it again.';
            };

            // --- Modal Close Button Logic ---
            const modalCloseBtn = document.getElementById('modalCloseBtn');
            const confirmationModal = document.getElementById('confirmationModal');
            modalCloseBtn.addEventListener('click', () => {
                confirmationModal.classList.remove('is-visible');
                // The object URL is now revoked immediately after download is triggered,
                // so no need to revoke here again.
            });

            // --- Loading Overlay and Confirmation Modal Elements ---
            const loadingOverlay = document.getElementById('loadingOverlay');
            const submitButton = bookingForm.querySelector('button[type="submit"]');


            // --- Searchable Dropdown Logic ---
            const countryCodeInput = document.getElementById('countryCodeInput');
            const countryCodeHidden = document.getElementById('countryCode');
            const countryList = document.getElementById('countryList');
            const phoneNumberInput = document.getElementById('phoneNumber'); // Get phone number input

            let selectedCountry = COUNTRIES.find(country => country.code === "+92"); // Default to Pakistan

            const renderCountries = (filter = '') => {
                countryList.innerHTML = '';
                const filteredCountries = COUNTRIES.filter(country => 
                    country.name.toLowerCase().includes(filter.toLowerCase()) || 
                    country.code.includes(filter) ||
                    country.iso.toLowerCase().includes(filter.toLowerCase())
                );
                filteredCountries.forEach(country => {
                    const li = document.createElement('li');
                    li.textContent = `${country.code} (${country.iso})`; // Display code + ISO
                    li.dataset.code = country.code;
                    li.dataset.iso = country.iso;
                    if (selectedCountry && selectedCountry.code === country.code) {
                        li.classList.add('selected'); // Highlight selected country
                    }
                    countryList.appendChild(li);
                });
            };

            const toggleDropdown = (show, inputElement, listElement) => {
                if (show) {
                    listElement.classList.add('is-open');
                    inputElement.setAttribute('aria-expanded', 'true');
                    // Scroll to selected item if it exists
                    const selectedLi = listElement.querySelector('.selected');
                    if (selectedLi) {
                        selectedLi.scrollIntoView({ block: 'nearest' });
                    }
                } else {
                    listElement.classList.remove('is-open');
                    inputElement.setAttribute('aria-expanded', 'false');
                }
            };

            countryCodeInput.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent document click from immediately closing
                if (!countryList.classList.contains('is-open')) {
                    renderCountries(); // Re-render to ensure selected is highlighted
                    toggleDropdown(true, countryCodeInput, countryList);
                } else {
                    toggleDropdown(false, countryCodeInput, countryList);
                }
            });

            countryCodeInput.addEventListener('input', (e) => {
                renderCountries(e.target.value);
                toggleDropdown(true, countryCodeInput, countryList);
            });

            countryList.addEventListener('click', (e) => {
                const selectedLi = e.target.closest('li');
                if (selectedLi) {
                    selectedCountry = COUNTRIES.find(country => country.code === selectedLi.dataset.code);
                    countryCodeInput.value = `${selectedCountry.code} (${selectedCountry.iso})`; // Display selected value
                    countryCodeHidden.value = selectedCountry.code;
                    phoneNumberInput.placeholder = selectedCountry.placeholder; // Update placeholder
                    toggleDropdown(false, countryCodeInput, countryList);
                }
            });

            document.addEventListener('click', (e) => {
                // Close country code, hour, minute dropdowns and calendar if click is outside their containers
                if (!e.target.closest('.custom-dropdown-container') && !e.target.closest('.calendar-popup')) {
                    toggleDropdown(false, countryCodeInput, countryList);
                    toggleDropdown(false, bookingHourInput, bookingHourList);
                    toggleDropdown(false, bookingMinuteInput, bookingMinuteList);
                    calendarPopup.classList.remove('is-open');
                    dateInput.setAttribute('aria-expanded', 'false');
                }

                // Close service sub-options if click is outside the services section
                if (!e.target.closest('#servicesSection')) {
                    if (activeServiceButton) {
                        activeServiceButton.classList.remove('active');
                        const prevSubOptions = document.getElementById(`sub-options-${activeServiceButton.dataset.service.replace(/\s/g, '-')}`);
                        if (prevSubOptions) {
                            prevSubOptions.classList.remove('is-open');
                        }
                        activeServiceButton = null;
                    }
                }
            });
            
            // Initial render and set default value for country code input
            // Set default selected country to Pakistan (+92)
            const defaultCountry = COUNTRIES.find(country => country.code === "+92");
            if (defaultCountry) {
                selectedCountry = defaultCountry;
                countryCodeInput.value = `${defaultCountry.code} (${defaultCountry.iso})`;
                countryCodeHidden.value = defaultCountry.code;
                phoneNumberInput.placeholder = defaultCountry.placeholder;
            }
            renderCountries();

            // --- Hour Dropdown Logic ---
            const bookingHourInputWrapper = document.getElementById('bookingHourInputWrapper');
            const bookingHourInput = document.getElementById('bookingHourInput');
            const bookingHourHidden = document.getElementById('bookingHourHidden');
            const bookingHourList = document.getElementById('bookingHourList');
            const selectedTimeDisplay = document.getElementById('selectedTimeDisplay');

            const HOURS = [
                { value: "16", display: "4 PM" },
                { value: "17", display: "5 PM" },
                { value: "18", display: "6 PM" },
                { value: "19", display: "7 PM" },
                { value: "20", display: "8 PM" }
            ];

            const renderHours = (filter = '') => {
                bookingHourList.innerHTML = '';
                const filteredHours = HOURS.filter(hour =>
                    hour.display.toLowerCase().includes(filter.toLowerCase())
                );
                filteredHours.forEach(hour => {
                    const li = document.createElement('li');
                    li.textContent = hour.display;
                    li.dataset.value = hour.value;
                    bookingHourList.appendChild(li);
                });
            };

            bookingHourInputWrapper.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent document click from immediately closing
                if (!bookingHourList.classList.contains('is-open')) {
                    renderHours();
                    toggleDropdown(true, bookingHourInputWrapper, bookingHourList);
                } else {
                    toggleDropdown(false, bookingHourInputWrapper, bookingHourList);
                }
            });

            bookingHourList.addEventListener('click', (e) => {
                const selectedLi = e.target.closest('li');
                if (selectedLi) {
                    bookingHourInput.value = selectedLi.textContent;
                    bookingHourHidden.value = selectedLi.dataset.value;
                    toggleDropdown(false, bookingHourInputWrapper, bookingHourList);
                    updateSelectedTimeDisplay();
                }
            });

            // --- Minute Dropdown Logic ---
            const bookingMinuteInputWrapper = document.getElementById('bookingMinuteInputWrapper');
            const bookingMinuteInput = document.getElementById('bookingMinuteInput');
            const bookingMinuteHidden = document.getElementById('bookingMinuteHidden');
            const bookingMinuteList = document.getElementById('bookingMinuteList');

            const MINUTES = [
                { value: "00", display: "00" },
                { value: "15", display: "15" },
                { value: "30", display: "30" },
                { value: "45", display: "45" }
            ];

            const renderMinutes = (filter = '') => {
                bookingMinuteList.innerHTML = '';
                const filteredMinutes = MINUTES.filter(minute =>
                    minute.display.includes(filter)
                );
                filteredMinutes.forEach(minute => {
                    const li = document.createElement('li');
                    li.textContent = minute.display;
                    li.dataset.value = minute.value;
                    bookingMinuteList.appendChild(li);
                });
            };

            bookingMinuteInputWrapper.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent document click from immediately closing
                if (!bookingMinuteList.classList.contains('is-open')) {
                    renderMinutes();
                    toggleDropdown(true, bookingMinuteInputWrapper, bookingMinuteList);
                } else {
                    toggleDropdown(false, bookingMinuteInputWrapper, bookingMinuteList);
                }
            });

            bookingMinuteList.addEventListener('click', (e) => {
                const selectedLi = e.target.closest('li');
                if (selectedLi) {
                    bookingMinuteInput.value = selectedLi.textContent;
                    bookingMinuteHidden.value = selectedLi.dataset.value;
                    toggleDropdown(false, bookingMinuteInputWrapper, bookingMinuteList);
                    updateSelectedTimeDisplay();
                }
            });

            // --- Update Selected Time Display ---
            const updateSelectedTimeDisplay = () => {
                const hour = bookingHourHidden.value;
                const minute = bookingMinuteHidden.value;
                const service = serviceHidden.value; // Get selected service
                const date = dateInput.value; // Get selected date
                if (hour && minute && date && service && hour !== "" && minute !== "" && service !== "") { // Ensure all are selected
                    const displayHour = parseInt(hour, 10);
                    const ampm = displayHour >= 12 ? 'PM' : 'AM';
                    const formattedHour = displayHour % 12 === 0 ? 12 : displayHour % 12;
                    selectedTimeDisplay.innerHTML = `Booking Appointment for: ${service}<br>At: ${formattedHour}:${minute} ${ampm}<br>On: ${date}`;
                    selectedTimeDisplay.classList.add('text-green-600', 'font-semibold'); // Premium styling
                } else {
                    selectedTimeDisplay.textContent = '';
                    selectedTimeDisplay.classList.remove('text-green-600', 'font-semibold'); // Remove styling when text is empty
                }
            };

            // --- Service Selection Logic (New Button-based) ---
            const mainServiceButtonsContainer = document.getElementById('mainServiceButtons');
            const serviceHidden = document.getElementById('serviceHidden');

            const ALL_SERVICES = {
                "General Dentistry": [
                    "Consultation & Check-up",
                    "Dental Cleaning (Scaling & Polishing)"
                ],
                "Cosmetic Dentistry": [
                    "Teeth Whitening",
                    "Dental Veneers",
                    "Smile Makeover (Composite Bonding / Veneers)"
                ],
                "Orthodontics": [
                    "Braces (Metal / Ceramic)",
                    "Invisalign (Clear Aligners)",
                    "Retainers"
                ],
                "Prosthodontics": [
                    "Dental Crowns",
                    "Dental Bridges",
                    "Complete Dentures",
                    "Partial Dentures"
                ],
                "Operative Dentistry": [
                    "Single Tooth Root Canal",
                    "Multi-Root Canal",
                    "Retreatment (previous RCT)",
                    "Tooth Filling Composite",
                    "Tooth Filling Amalgam",
                    "Tooth Extraction (Simple / Surgical)"
                ],
                "Pediatric Dentistry": [
                    "Kids’ Check-up",
                    "Fluoride Treatment",
                    "Fissure Sealants",
                    "Pediatric Filling",
                    "Pediatric Extraction"
                ],
                "Oral Surgery": [
                    "Surgical Extraction (Wisdom Tooth)",
                    "Cyst/Minor Surgery"
                ],
                "Preventive Care": [
                    "Gum Disease Treatment",
                    "Deep Cleaning (Scaling & Root Planing)",
                    "Gum Surgery"
                ],
                "Implants & Restorations": [
                    "Implant Consultation",
                    "Dental Implant Consultation",
                    "Single Tooth Implant",
                    "Full Mouth Implant Solution"
                ]
            };

            let activeServiceButton = null;
            let selectedSubOption = null;

            const renderServiceButtons = () => {
                mainServiceButtonsContainer.innerHTML = '';
                for (const mainService in ALL_SERVICES) {
                    const buttonWrapper = document.createElement('div');
                    buttonWrapper.classList.add('col-span-1'); // Ensure it takes full width on small screens, half on md

                    const button = document.createElement('button');
                    button.type = 'button';
                    button.classList.add('service-button');
                    button.dataset.service = mainService;
                    button.innerHTML = `
                        <span>${mainService}</span>
                        <svg class="arrow-icon w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                        </svg>
                    `;

                    const subOptionsContainer = document.createElement('div');
                    subOptionsContainer.classList.add('sub-options-container', 'space-y-2');
                    subOptionsContainer.id = `sub-options-${mainService.replace(/\s/g, '-')}`;

                    ALL_SERVICES[mainService].forEach(subOption => {
                        const subOptionItem = document.createElement('div');
                        subOptionItem.classList.add('sub-option-item', 'flex', 'items-center', 'justify-between');
                        subOptionItem.dataset.subOption = subOption;
                        subOptionItem.innerHTML = `
                            <span>${subOption}</span>
                            <i class="fas fa-check-circle text-green-500 opacity-0 transform scale-0 transition-all duration-300 ease-out"></i>
                        `;
                        subOptionItem.addEventListener('click', (e) => {
                            e.stopPropagation(); // Prevent main button from toggling
                            // If the clicked sub-option is already selected, deselect it
                            if (subOptionItem.classList.contains('selected')) {
                                subOptionItem.classList.remove('selected');
                                subOptionItem.querySelector('.fa-check-circle').classList.remove('opacity-100', 'scale-100');
                                selectedSubOption = null;
                                serviceHidden.value = ''; // Clear hidden service value
                            } else {
                                // Deselect previously selected sub-option if any
                                if (selectedSubOption) {
                                    selectedSubOption.classList.remove('selected');
                                    selectedSubOption.querySelector('.fa-check-circle').classList.remove('opacity-100', 'scale-100');
                                }
                                // Select the current sub-option
                                subOptionItem.classList.add('selected');
                                subOptionItem.querySelector('.fa-check-circle').classList.add('opacity-100', 'scale-100');
                                selectedSubOption = subOptionItem;
                                serviceHidden.value = subOption; // Update hidden input with selected sub-option
                            }
                            updateSelectedTimeDisplay(); // Update confirmation text
                        });
                        subOptionsContainer.appendChild(subOptionItem);
                    });

                    button.addEventListener('click', (e) => {
                        e.stopPropagation(); // Prevent event from bubbling up to document click listener

                        // If the clicked button is already active, deactivate it
                        if (button.classList.contains('active')) {
                            button.classList.remove('active');
                            subOptionsContainer.classList.remove('is-open');
                            button.classList.remove('active'); // Ensure the main button also deactivates
                            activeServiceButton = null;
                            // Do NOT clear selectedSubOption or serviceHidden.value here,
                            // as the user wants it to remain selected visually and functionally.
                            updateSelectedTimeDisplay(); // Update confirmation text
                        } else {
                            // Deactivate previously active button and close its sub-options
                            if (activeServiceButton) {
                                activeServiceButton.classList.remove('active');
                                const prevSubOptions = document.getElementById(`sub-options-${activeServiceButton.dataset.service.replace(/\s/g, '-')}`);
                                if (prevSubOptions) {
                                    prevSubOptions.classList.remove('is-open');
                                }
                            }

                            // Activate the current button and open its sub-options
                            button.classList.add('active');
                            subOptionsContainer.classList.add('is-open');
                            activeServiceButton = button;
                        }
                    });

                    buttonWrapper.appendChild(button);
                    buttonWrapper.appendChild(subOptionsContainer);
                    mainServiceButtonsContainer.appendChild(buttonWrapper);
                }
            };

            // Initial render of service buttons
            renderServiceButtons();

            // --- Custom Calendar Logic ---

            let today = new Date();
            let currentMonth = today.getMonth();
            let currentYear = today.getFullYear();
            let selectedDate = null;

            const dayNames = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];

            function renderCalendar(month, year) {
                calendarGrid.innerHTML = "";

                // Add day names
                dayNames.forEach(d => {
                    const div = document.createElement('div');
                    div.textContent = d;
                    div.classList.add("day-name");
                    calendarGrid.appendChild(div);
                });

                const firstDay = new Date(year, month).getDay(); 
                const daysInMonth = new Date(year, month + 1, 0).getDate();

                // Calculate start index (make Monday the first column)
                const offset = (firstDay + 6) % 7;

                // Fill empty slots
                for (let i = 0; i < offset; i++) {
                    const div = document.createElement('div');
                    calendarGrid.appendChild(div);
                }

                for (let day = 1; day <= daysInMonth; day++) {
                    const div = document.createElement('div');
                    div.textContent = day;

                    const dateObj = new Date(year, month, day);

                    // Sundays in red and disabled
                    if (dateObj.getDay() === 0) {
                        div.classList.add("sunday");
                        div.classList.add("disabled");
                    }

                    // Disable past dates
                    if (dateObj < new Date(today.getFullYear(), today.getMonth(), today.getDate())) {
                        div.classList.add("disabled");
                    }

                    // Highlight today
                    if (
                        day === today.getDate() &&
                        month === today.getMonth() &&
                        year === today.getFullYear()
                    ) {
                        div.classList.add("today");
                    }

                    // Highlight previously selected date
                    if (selectedDate && dateObj.toDateString() === selectedDate.toDateString()) {
                        div.classList.add("selected");
                    }

                    // Select date
                    div.addEventListener("click", () => {
                        if (!div.classList.contains("disabled")) {
                            document.querySelectorAll(".calendar-grid .selected").forEach(el => el.classList.remove("selected"));
                            div.classList.add("selected");
                            selectedDate = dateObj;
                            dateInput.value = selectedDate.toLocaleDateString("en-US", { year: "numeric", month: "2-digit", day: "2-digit" });
                            calendarPopup.classList.remove('is-open');
                            dateInput.setAttribute('aria-expanded', 'false');
                            updateSelectedTimeDisplay(); // Update confirmation text when date is selected
                        }
                    });

                    calendarGrid.appendChild(div);
                }

                monthYear.textContent = new Date(year, month).toLocaleDateString("en-US", { month: "long", year: "numeric" });
            }

            prevMonth.addEventListener("click", () => {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                renderCalendar(currentMonth, currentYear);
            });

            nextMonth.addEventListener("click", () => {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                renderCalendar(currentMonth, currentYear);
            });

            dateInput.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent the document click listener from immediately closing it
                calendarPopup.classList.toggle('is-open');
                dateInput.setAttribute('aria-expanded', calendarPopup.classList.contains('is-open'));
                renderCalendar(currentMonth, currentYear);
            });

            // Set default selected date to today
            selectedDate = today;
            dateInput.value = selectedDate.toLocaleDateString("en-US", { year: "numeric", month: "2-digit", day: "2-digit" });
            renderCalendar(currentMonth, currentYear);

            // Add event listeners for the otherIssues textarea
            const otherIssuesTextarea = document.getElementById('Notes');
            if (otherIssuesTextarea) {
                otherIssuesTextarea.addEventListener('focus', function() {
                    this.rows = 3;
                });
                otherIssuesTextarea.addEventListener('blur', function() {
                    if (this.value === '') {
                        this.rows = 1;
                    }
                });
            }
            // Initial setup for bookingCard classes
            bookingCard.classList.add('booking-card-initial');

            const availabilityMessage = document.getElementById('availabilityMessage');
            const confirmAppointmentBtn = document.getElementById('confirmAppointmentBtn');
            let bookedSlotsData = {}; // To store fetched availability

            // --- Real-time Availability Check ---
            const checkSlotAvailability = () => {
                const date = dateInput.value;
                const hour = bookingHourHidden.value;
                const minute = bookingMinuteHidden.value;

                if (date && hour && minute) {
                    const time = `${hour}:${minute}`;
                    const slotKey = `${date} ${time}`;
                    const currentBookings = bookedSlotsData[slotKey] || 0;
                    const MAX_BOOKINGS_PER_SLOT = 2;

                    if (currentBookings >= MAX_BOOKINGS_PER_SLOT) {
                        availabilityMessage.textContent = "This time slot is fully booked. Please select another time.";
                        availabilityMessage.classList.remove('hidden');
                        confirmAppointmentBtn.disabled = true;
                        confirmAppointmentBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    } else {
                        availabilityMessage.classList.add('hidden');
                        confirmAppointmentBtn.disabled = false;
                        confirmAppointmentBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    }
                } else {
                    // If any part of the date/time is missing, hide the message and enable the button
                    availabilityMessage.classList.add('hidden');
                    confirmAppointmentBtn.disabled = false;
                    confirmAppointmentBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            };

            const fetchBookedSlots = async () => {
                try {
                    const response = await fetch(WEB_APP_URL + '?action=getBookedSlots'); // Use doGet for fetching
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    bookedSlotsData = await response.json();
                    console.log("Fetched booked slots:", bookedSlotsData);
                } catch (error) {
                    console.error("Error fetching booked slots:", error);
                    // Optionally, display an error message to the user
                }
            };

            const updateAvailabilityMessage = () => {
                const date = dateInput.value;
                const hour = bookingHourHidden.value;
                const minute = bookingMinuteHidden.value;

                if (date && hour && minute) {
                    const slotKey = `${date} ${hour}:${minute}`;
                    const currentBookings = bookedSlotsData[slotKey] || 0;
                    const MAX_BOOKINGS_PER_SLOT = 2; // Must match backend

                    if (currentBookings >= MAX_BOOKINGS_PER_SLOT) {
                        availabilityMessage.textContent = "Time slot not available. Please choose a different time.";
                        availabilityMessage.classList.remove('hidden');
                        confirmAppointmentBtn.disabled = true;
                        confirmAppointmentBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    } else {
                        availabilityMessage.classList.add('hidden');
                        confirmAppointmentBtn.disabled = false;
                        confirmAppointmentBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    }
                } else {
                    availabilityMessage.classList.add('hidden');
                    confirmAppointmentBtn.disabled = false; // Re-enable if no selection
                    confirmAppointmentBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            };

            // Call fetchBookedSlots on page load
            fetchBookedSlots();

            // Add event listeners to relevant inputs to trigger the real-time availability check
            dateInput.addEventListener('change', checkSlotAvailability);
            
            // Since the hidden inputs don't have a change event, we'll re-check when the visible inputs are updated.
            bookingHourList.addEventListener('click', () => setTimeout(checkSlotAvailability, 0));
            bookingMinuteList.addEventListener('click', () => setTimeout(checkSlotAvailability, 0));
            
            // Also call the check when the form becomes visible
            firstTimePatientBtn.addEventListener('click', () => {
                setTimeout(checkSlotAvailability, 100); // Delay to allow form to become visible
            });
            submitClientIDBtn.addEventListener('click', () => {
                setTimeout(checkSlotAvailability, 100);
            });
        });

        /**
         * Sends the complete booking data, including IDs and the PDF from Google Apps Script,
         * to the Render backend to trigger the confirmation email with the PDF attachment.
         * @param {object} bookingData - The original booking data from the form.
         * @param {object} appsScriptResponse - The JSON response from the Google Apps Script.
         */
        async function sendConfirmationEmailWithAttachment(bookingData, appsScriptResponse) {
            const renderUrl = 'https://wafa-dental-backend.onrender.com/send-confirmation';
            
            const emailPayload = {
                clientName: `${bookingData.FirstName} ${bookingData.LastName}`,
                clientEmail: bookingData.Email,
                service: bookingData.Service,
                date: bookingData.Date,
                time: bookingData.Time,
                bookingId: appsScriptResponse.bookingID,
                clientId: appsScriptResponse.clientID,
                pdfBase64: appsScriptResponse.pdfBase64
            };

            console.log('Sending confirmation email with PDF attachment. Payload:', emailPayload);

            try {
                const response = await fetch(renderUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(emailPayload),
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log('Successfully sent confirmation email request:', result.message);
                } else {
                    const errorResult = await response.json();
                    console.error('Failed to send confirmation email. Server responded with:', errorResult.message);
                }
            } catch (error) {
                console.error('An error occurred while trying to send the confirmation email:', error);
            }
        }
    </script>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
    </div>

    <!-- Booking Confirmation Modal -->
    <div id="confirmationModal" class="modal-overlay">
        <div class="modal-content">
            <button type="button" id="modalCloseBtn" class="modal-close-btn" aria-label="Close booking confirmation">
                &times;
            </button>
                        <h2 class="modal-title">Your Booking is Confirmed!</h2>
                        <p class="modal-subtitle">Your E-ticket Receipt is downloading.</p>
        </div>
    </div>
</body>
</html>
